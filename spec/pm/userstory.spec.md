# 用户故事规格书：LearnHub

<meta>
  <document-id>learnhub-userstory-spec</document-id>
  <version>1.0.0</version>
  <project>LearnHub 学习平台</project>
  <type>用户故事规格书</type>
  <created>2025-01-30</created>
  <depends>real.md, cog.md, pr.spec.md</depends>
</meta>

---

## 复杂故事概览

| 复杂故事 | 名称 | 最小故事数 | 优先级 | 故事类型分布 |
|---------|------|-----------|--------|-------------|
| CS-01 | 用户入门 | 5 | P0 | 光明3, 黑暗2 |
| CS-02 | 课程购买 | 6 | P0 | 光明3, 黑暗2, 灰色1 |
| CS-03 | 学习体验 | 5 | P0 | 光明2, 黑暗1, 灰色2 |
| CS-04 | 会员订阅 | 4 | P1 | 光明2, 黑暗1, 灰色1 |
| CS-05 | 企业培训 | 6 | P2 | 光明3, 黑暗1, 灰色2 |

**总计**：26 个最小故事

---

## CS-01：用户入门

**描述**：新用户从注册到首次进入平台的完整旅程
**用户类型**：新访客
**核心价值**：快速进入平台，开始探索学习内容

**用户旅程**：
```
访问首页 → 注册账户 → 登录 → 浏览课程
```

---

### MS-L-01：快速注册

**复杂故事**：CS-01
**故事类型**：光明（从无账户到有账户）
**优先级**：P0
**故事点数**：3

#### 用户故事
作为一个**新访客**，
我想要**使用手机号或邮箱快速注册账户**，
以便**开始浏览和购买课程**。

#### 故事评判
- **起点状态**：无法购买课程，只能浏览
- **转折点**：完成注册流程
- **终点状态**：拥有账户，可以购买和学习
- **情感体验**：从受限 → 获得权限

#### 验收标准
- [ ] 用户可以看到注册入口（首页右上角）
- [ ] 支持手机号 + 验证码注册
- [ ] 支持邮箱 + 密码注册
- [ ] 密码强度实时提示
- [ ] 注册成功后自动登录

#### 约束（来自 real.md）
- R-01：密码必须 bcrypt 加密存储

#### 依赖
- **需要**：无
- **使能**：MS-L-02（登录）

---

### MS-L-02：用户登录

**复杂故事**：CS-01
**故事类型**：光明（从门外到进入）
**优先级**：P0
**故事点数**：2

#### 用户故事
作为一个**已注册用户**，
我想要**使用账号密码登录**，
以便**访问我购买的课程**。

#### 验收标准
- [ ] 登录表单包含账号、密码输入框
- [ ] 支持「记住我」选项
- [ ] 登录成功后跳转到首页或之前页面
- [ ] 登录状态持久化（刷新不丢失）

#### 依赖
- **需要**：MS-L-01（有账户）
- **使能**：MS-L-03（浏览课程）

---

### MS-D-01：登录失败处理

**复杂故事**：CS-01
**故事类型**：黑暗（遇到障碍并恢复）
**优先级**：P0
**故事点数**：2

#### 用户故事
作为一个**输入错误凭证的用户**，
我想要**看到清晰的错误提示**，
以便**知道如何修正并重试**。

#### 故事评判
- **起点状态**：尝试登录
- **转折点**：凭证错误被拒绝
- **终点状态**：了解错误原因，可以重试或找回密码
- **情感体验**：从困惑 → 受阻 → 得到帮助

#### 验收标准
- [ ] 密码错误时显示「账号或密码错误」
- [ ] 提供「忘记密码」链接
- [ ] 连续失败 5 次后显示验证码
- [ ] 不泄露账户是否存在

#### 依赖
- **需要**：MS-L-02
- **使能**：无

---

### MS-D-02：会话过期处理

**复杂故事**：CS-01
**故事类型**：黑暗（会话中断并恢复）
**优先级**：P1
**故事点数**：2

#### 用户故事
作为一个**会话过期的用户**，
我想要**被引导重新登录**，
以便**继续之前的操作**。

#### 验收标准
- [ ] 会话过期时显示友好提示
- [ ] 提供重新登录按钮
- [ ] 登录后返回之前的页面
- [ ] 购物车数据不丢失

#### 依赖
- **需要**：MS-L-02
- **使能**：无

---

### MS-L-03：首次浏览课程

**复杂故事**：CS-01
**故事类型**：光明（从陌生到熟悉）
**优先级**：P0
**故事点数**：2

#### 用户故事
作为一个**首次进入平台的用户**，
我想要**看到清晰的课程分类和推荐**，
以便**快速找到感兴趣的内容**。

#### 验收标准
- [ ] 首页展示热门课程推荐
- [ ] 显示课程分类导航
- [ ] 课程卡片展示封面、标题、价格
- [ ] 支持按分类筛选

#### 依赖
- **需要**：无（游客也可浏览）
- **使能**：CS-02（课程购买）

---

## CS-02：课程购买

**描述**：用户从发现课程到完成购买的完整流程
**用户类型**：已登录用户
**核心价值**：顺利购买想要的课程

**用户旅程**：
```
浏览课程 → 查看详情 → 加入购物车 → 下单 → 支付 → 获得授权
```

---

### MS-L-04：查看课程详情

**复杂故事**：CS-02
**故事类型**：光明（从不了解到了解）
**优先级**：P0
**故事点数**：3

#### 用户故事
作为一个**对某课程感兴趣的用户**，
我想要**查看课程的详细信息**，
以便**决定是否购买**。

#### 验收标准
- [ ] 显示课程封面、标题、简介
- [ ] 显示课程大纲（章节列表）
- [ ] 显示讲师信息
- [ ] 显示价格和购买按钮
- [ ] 显示用户评价
- [ ] 支持试看部分内容

#### API
- GET /api/courses/:slug

#### 依赖
- **需要**：MS-L-03
- **使能**：MS-L-05（购买）

---

### MS-L-05：添加购物车并下单

**复杂故事**：CS-02
**故事类型**：光明（从想要到拥有）
**优先级**：P0
**故事点数**：3

#### 用户故事
作为一个**决定购买课程的用户**，
我想要**将课程加入购物车并创建订单**，
以便**进行支付**。

#### 故事评判
- **起点状态**：想要这个课程但没有
- **转折点**：完成下单
- **终点状态**：订单已创建，等待支付
- **情感体验**：从期待 → 行动 → 接近目标

#### 验收标准
- [ ] 点击「立即购买」或「加入购物车」
- [ ] 购物车显示已添加商品
- [ ] 结算页显示商品清单和总价
- [ ] 支持使用优惠券
- [ ] 确认后创建订单

#### API
- POST /api/cart
- POST /api/orders

#### 约束（来自 real.md）
- R-03：订单金额由服务端计算

#### 依赖
- **需要**：MS-L-02（登录）、MS-L-04（查看详情）
- **使能**：MS-L-06（支付）

---

### MS-L-06：完成支付

**复杂故事**：CS-02
**故事类型**：光明（从未支付到已支付）
**优先级**：P0
**故事点数**：5

#### 用户故事
作为一个**已下单的用户**，
我想要**使用微信或支付宝完成支付**，
以便**获得课程的学习权限**。

#### 故事评判
- **起点状态**：订单待支付
- **转折点**：扫码支付成功
- **终点状态**：获得课程授权，可以开始学习
- **情感体验**：从紧张 → 确认 → 满足

#### 验收标准
- [ ] 显示支付方式选择（微信/支付宝）
- [ ] 生成支付二维码
- [ ] 支付成功后显示确认页面
- [ ] 自动创建课程授权（License）
- [ ] 发送购买成功通知

#### API
- POST /api/payments/create
- POST /api/payments/callback（回调）

#### 约束（来自 real.md）
- R-02：支付走官方 API，不存储支付凭证

#### 依赖
- **需要**：MS-L-05
- **使能**：CS-03（学习体验）

---

### MS-D-03：支付失败处理

**复杂故事**：CS-02
**故事类型**：黑暗（支付中断并恢复）
**优先级**：P0
**故事点数**：2

#### 用户故事
作为一个**支付失败的用户**，
我想要**看到失败原因并能重试**，
以便**完成购买**。

#### 验收标准
- [ ] 支付超时显示「支付超时，请重试」
- [ ] 余额不足显示明确提示
- [ ] 提供「重新支付」按钮
- [ ] 订单状态保持「待支付」
- [ ] 支持更换支付方式

#### 依赖
- **需要**：MS-L-06
- **使能**：无

---

### MS-D-04：重复购买提示

**复杂故事**：CS-02
**故事类型**：黑暗（防止错误购买）
**优先级**：P1
**故事点数**：1

#### 用户故事
作为一个**已购买某课程的用户**，
我想要**在尝试再次购买时看到提示**，
以便**避免重复付费**。

#### 验收标准
- [ ] 已购买课程显示「已拥有」标识
- [ ] 购买按钮变为「开始学习」
- [ ] 尝试加入购物车时提示「您已拥有此课程」

#### 依赖
- **需要**：MS-L-06（已购买）
- **使能**：无

---

### MS-G-01：查看订单历史

**复杂故事**：CS-02
**故事类型**：灰色（日常查询）
**优先级**：P1
**故事点数**：2

#### 用户故事
作为一个**有购买记录的用户**，
我想要**查看我的订单历史**，
以便**了解购买记录和发票信息**。

#### 验收标准
- [ ] 个人中心显示「我的订单」入口
- [ ] 订单列表按时间倒序排列
- [ ] 显示订单状态（待支付/已支付/已取消）
- [ ] 支持查看订单详情
- [ ] 支持下载发票（如有）

#### API
- GET /api/orders

#### 依赖
- **需要**：MS-L-06（有订单）
- **使能**：无

---

## CS-03：学习体验

**描述**：用户学习已购买课程的完整流程
**用户类型**：已购买课程的用户
**核心价值**：流畅学习，获得知识

**用户旅程**：
```
进入课程 → 观看视频 → 记录进度 → 完成学习 → 获得证书
```

---

### MS-L-07：进入课程学习

**复杂故事**：CS-03
**故事类型**：光明（从购买到学习）
**优先级**：P0
**故事点数**：2

#### 用户故事
作为一个**已购买课程的用户**，
我想要**进入课程开始学习**，
以便**获取课程知识**。

#### 验收标准
- [ ] 「我的学习」页面显示已购课程
- [ ] 点击课程进入学习页面
- [ ] 显示课程目录（章节列表）
- [ ] 显示学习进度

#### API
- GET /api/licenses（我的授权）
- GET /api/courses/:id/chapters

#### 约束（来自 real.md）
- R-04：验证用户授权后才能访问

#### 依赖
- **需要**：MS-L-06（已购买）
- **使能**：MS-L-08（观看视频）

---

### MS-L-08：观看课程视频

**复杂故事**：CS-03
**故事类型**：光明（从不懂到理解）
**优先级**：P0
**故事点数**：5

#### 用户故事
作为一个**正在学习的用户**，
我想要**流畅观看课程视频**，
以便**学习课程内容**。

#### 故事评判
- **起点状态**：对知识点不了解
- **转折点**：观看视频学习
- **终点状态**：理解并掌握知识
- **情感体验**：从困惑 → 专注 → 理解

#### 验收标准
- [ ] 视频播放器加载正常
- [ ] 支持播放、暂停、进度拖动
- [ ] 支持切换清晰度（480p/720p/1080p）
- [ ] 支持倍速播放（0.5x-2x）
- [ ] 自动记录观看进度
- [ ] 支持全屏播放

#### 约束（来自 real.md）
- R-04：每次播放前验证授权
- 视频流加密传输

#### 依赖
- **需要**：MS-L-07
- **使能**：MS-G-02（继续学习）

---

### MS-D-05：视频加载失败处理

**复杂故事**：CS-03
**故事类型**：黑暗（播放失败并恢复）
**优先级**：P1
**故事点数**：2

#### 用户故事
作为一个**视频加载失败的用户**，
我想要**看到错误提示并能重试**，
以便**继续学习**。

#### 验收标准
- [ ] 网络错误显示「加载失败，请检查网络」
- [ ] 提供「重试」按钮
- [ ] 授权过期显示「请重新购买或续费」
- [ ] 提供切换清晰度选项

#### 依赖
- **需要**：MS-L-08
- **使能**：无

---

### MS-G-02：继续上次学习

**复杂故事**：CS-03
**故事类型**：灰色（日常学习）
**优先级**：P0
**故事点数**：2

#### 用户故事
作为一个**回访学习的用户**，
我想要**从上次离开的位置继续学习**，
以便**不浪费时间找进度**。

#### 故事评判
- **循环模式**：打开课程 → 继续上次 → 学习 → 离开 → 再次打开
- **优化点**：自动定位、快速恢复
- **习惯养成**：形成持续学习的习惯

#### 验收标准
- [ ] 「我的学习」显示最近学习记录
- [ ] 点击「继续学习」跳转到上次位置
- [ ] 视频自动跳转到上次播放点
- [ ] 显示已完成章节标记

#### 依赖
- **需要**：MS-L-08（有学习记录）
- **使能**：无

---

### MS-G-03：完成课程获得证书

**复杂故事**：CS-03
**故事类型**：灰色（学习闭环）
**优先级**：P2
**故事点数**：3

#### 用户故事
作为一个**完成全部课程的用户**，
我想要**获得学习证书**，
以便**证明我的学习成果**。

#### 验收标准
- [ ] 所有章节完成后显示「课程完成」
- [ ] 生成学习证书（含姓名、课程、日期）
- [ ] 支持下载证书图片
- [ ] 证书可分享到社交媒体

#### 依赖
- **需要**：MS-L-08（完成所有章节）
- **使能**：无

---

## CS-04：会员订阅

**描述**：用户开通和管理会员订阅的流程
**用户类型**：希望持续学习的用户
**核心价值**：以更优惠的价格获取更多内容

**用户旅程**：
```
了解会员 → 选择套餐 → 开通会员 → 享受权益 → 续费
```

---

### MS-L-09：了解会员权益

**复杂故事**：CS-04
**故事类型**：光明（从不了解到了解）
**优先级**：P1
**故事点数**：2

#### 用户故事
作为一个**考虑订阅会员的用户**，
我想要**清楚了解会员权益和价格**，
以便**做出购买决定**。

#### 验收标准
- [ ] 会员专区入口清晰可见
- [ ] 展示不同套餐（月度/季度/年度）
- [ ] 对比普通用户和会员权益
- [ ] 显示会员专享课程数量
- [ ] 标注推荐套餐

#### 依赖
- **需要**：无
- **使能**：MS-L-10（开通会员）

---

### MS-L-10：开通会员

**复杂故事**：CS-04
**故事类型**：光明（从普通用户到会员）
**优先级**：P1
**故事点数**：3

#### 用户故事
作为一个**决定订阅的用户**，
我想要**选择套餐并完成支付**，
以便**成为会员开始享受权益**。

#### 故事评判
- **起点状态**：普通用户，需单独购买课程
- **转折点**：订阅会员
- **终点状态**：会员身份，可访问会员内容
- **情感体验**：从犹豫 → 决定 → 满足

#### 验收标准
- [ ] 选择会员套餐
- [ ] 完成支付流程
- [ ] 支付成功后立即生效
- [ ] 显示会员有效期
- [ ] 发送开通成功通知

#### API
- POST /api/memberships

#### 依赖
- **需要**：MS-L-02（登录）、MS-L-09
- **使能**：会员专享内容访问

---

### MS-D-06：会员到期提醒

**复杂故事**：CS-04
**故事类型**：黑暗（提前预警）
**优先级**：P1
**故事点数**：2

#### 用户故事
作为一个**会员即将到期的用户**，
我想要**收到到期提醒**，
以便**及时续费不中断学习**。

#### 验收标准
- [ ] 到期前 7 天发送提醒
- [ ] 到期前 1 天再次提醒
- [ ] 页面显示会员剩余天数
- [ ] 提供便捷续费入口

#### 依赖
- **需要**：MS-L-10（是会员）
- **使能**：MS-G-04（续费）

---

### MS-G-04：会员续费

**复杂故事**：CS-04
**故事类型**：灰色（周期性操作）
**优先级**：P1
**故事点数**：2

#### 用户故事
作为一个**需要续费的会员**，
我想要**快速完成续费**，
以便**继续享受会员权益**。

#### 验收标准
- [ ] 会员中心显示「续费」按钮
- [ ] 续费自动延长有效期
- [ ] 支持升级套餐（月→年）
- [ ] 续费优惠提示

#### 依赖
- **需要**：MS-L-10
- **使能**：无

---

## CS-05：企业培训

**描述**：企业管理员采购和管理团队学习的流程
**用户类型**：企业管理员
**核心价值**：高效管理团队培训，提升团队能力

**用户旅程**：
```
注册企业 → 批量采购 → 邀请员工 → 分配课程 → 监控进度
```

---

### MS-L-11：注册企业账户

**复杂故事**：CS-05
**故事类型**：光明（从个人到企业）
**优先级**：P2
**故事点数**：3

#### 用户故事
作为一个**企业采购负责人**，
我想要**注册企业账户**，
以便**为公司员工采购培训课程**。

#### 验收标准
- [ ] 企业注册入口可见
- [ ] 填写企业信息（名称、规模、联系人）
- [ ] 提交企业资质（选填）
- [ ] 审核通过后开通企业账户
- [ ] 成为企业管理员

#### API
- POST /api/organizations

#### 依赖
- **需要**：MS-L-02（个人账户）
- **使能**：MS-L-12（批量采购）

---

### MS-L-12：批量采购课程

**复杂故事**：CS-05
**故事类型**：光明（从无到有企业资源）
**优先级**：P2
**故事点数**：3

#### 用户故事
作为一个**企业管理员**，
我想要**批量采购课程或企业会员**，
以便**为团队提供学习资源**。

#### 验收标准
- [ ] 企业专区显示批量采购入口
- [ ] 设置采购数量（席位数）
- [ ] 显示团购优惠价格
- [ ] 支持申请报价单
- [ ] 支持对公转账

#### API
- POST /api/organizations/:id/purchases

#### 依赖
- **需要**：MS-L-11
- **使能**：MS-L-13（邀请员工）

---

### MS-L-13：邀请员工加入

**复杂故事**：CS-05
**故事类型**：光明（扩展团队）
**优先级**：P2
**故事点数**：2

#### 用户故事
作为一个**企业管理员**，
我想要**邀请员工加入企业账户**，
以便**员工可以使用企业采购的资源**。

#### 验收标准
- [ ] 生成邀请链接
- [ ] 支持批量导入员工邮箱
- [ ] 员工点击链接注册并加入企业
- [ ] 管理员可查看员工列表

#### 约束（来自 real.md）
- R-05：员工数据仅本企业管理员可见

#### 依赖
- **需要**：MS-L-12
- **使能**：MS-G-05（分配课程）

---

### MS-G-05：分配学习任务

**复杂故事**：CS-05
**故事类型**：灰色（日常管理）
**优先级**：P2
**故事点数**：2

#### 用户故事
作为一个**企业管理员**，
我想要**给员工分配学习任务**，
以便**推动团队完成培训计划**。

#### 验收标准
- [ ] 选择员工或团队
- [ ] 选择课程或学习路径
- [ ] 设置完成期限
- [ ] 员工收到任务通知
- [ ] 管理员可查看任务分配情况

#### 依赖
- **需要**：MS-L-13（有员工）
- **使能**：MS-G-06（监控进度）

---

### MS-G-06：查看团队学习数据

**复杂故事**：CS-05
**故事类型**：灰色（日常监控）
**优先级**：P2
**故事点数**：3

#### 用户故事
作为一个**企业管理员**，
我想要**查看团队学习进度和统计数据**，
以便**了解培训效果**。

#### 验收标准
- [ ] 数据看板显示整体完成率
- [ ] 按员工查看个人进度
- [ ] 按课程查看学习情况
- [ ] 支持导出报表（Excel/PDF）

#### 约束（来自 real.md）
- R-05：数据严格隔离，不同企业不可互见

#### 依赖
- **需要**：MS-G-05（有学习数据）
- **使能**：无

---

### MS-D-07：员工离职处理

**复杂故事**：CS-05
**故事类型**：黑暗（异常处理）
**优先级**：P2
**故事点数**：2

#### 用户故事
作为一个**企业管理员**，
我想要**移除离职员工的权限**，
以便**回收授权席位**。

#### 验收标准
- [ ] 管理员可移除员工
- [ ] 移除后员工无法访问企业资源
- [ ] 席位回收可分配给新员工
- [ ] 保留该员工的学习记录（供审计）

#### 依赖
- **需要**：MS-L-13
- **使能**：无

---

## 故事地图

```
用户旅程：入门 → 购买 → 学习 → 会员 → 企业

迭代1（MVP）:
├── CS-01: 用户入门
│   ├── MS-L-01: 快速注册（光明）
│   ├── MS-L-02: 用户登录（光明）
│   ├── MS-D-01: 登录失败处理（黑暗）
│   └── MS-L-03: 首次浏览课程（光明）
├── CS-02: 课程购买
│   ├── MS-L-04: 查看课程详情（光明）
│   ├── MS-L-05: 添加购物车并下单（光明）
│   ├── MS-L-06: 完成支付（光明）
│   └── MS-D-03: 支付失败处理（黑暗）
└── CS-03: 学习体验
    ├── MS-L-07: 进入课程学习（光明）
    ├── MS-L-08: 观看课程视频（光明）
    └── MS-G-02: 继续上次学习（灰色）

迭代2:
├── CS-01: 用户入门（续）
│   └── MS-D-02: 会话过期处理（黑暗）
├── CS-02: 课程购买（续）
│   ├── MS-D-04: 重复购买提示（黑暗）
│   └── MS-G-01: 查看订单历史（灰色）
├── CS-03: 学习体验（续）
│   ├── MS-D-05: 视频加载失败处理（黑暗）
│   └── MS-G-03: 完成课程获得证书（灰色）
└── CS-04: 会员订阅
    ├── MS-L-09: 了解会员权益（光明）
    ├── MS-L-10: 开通会员（光明）
    ├── MS-D-06: 会员到期提醒（黑暗）
    └── MS-G-04: 会员续费（灰色）

迭代3:
└── CS-05: 企业培训
    ├── MS-L-11: 注册企业账户（光明）
    ├── MS-L-12: 批量采购课程（光明）
    ├── MS-L-13: 邀请员工加入（光明）
    ├── MS-G-05: 分配学习任务（灰色）
    ├── MS-G-06: 查看团队学习数据（灰色）
    └── MS-D-07: 员工离职处理（黑暗）
```

---

## 故事类型分布

| 迭代 | 光明 | 黑暗 | 灰色 | 总计 |
|------|------|------|------|------|
| 迭代1 | 8 (73%) | 2 (18%) | 1 (9%) | 11 |
| 迭代2 | 2 (25%) | 3 (37%) | 3 (38%) | 8 |
| 迭代3 | 3 (43%) | 1 (14%) | 3 (43%) | 7 |

**符合 MVP 阶段黄金比例**：
- 迭代1：光明故事为主（73%），快速展示核心价值
- 迭代2：增加黑暗故事，完善异常处理
- 迭代3：灰色故事增多，优化日常使用体验

---

## 与 MAS（最小可供故事）的映射

| MAS | 对应的复杂故事 | 核心最小故事 |
|-----|---------------|-------------|
| MAS-1: 购买并学习 | CS-01 + CS-02 + CS-03 | MS-L-01~08 |
| MAS-2: 订阅会员 | CS-04 | MS-L-09~10, MS-D-06, MS-G-04 |
| MAS-3: 企业培训 | CS-05 | MS-L-11~13, MS-G-05~06, MS-D-07 |

---

## 质量检查清单

- [x] 所有核心功能都有对应的最小故事
- [x] 每个最小故事遵循 INVEST 原则
- [x] 故事类型分布合理（光明为主）
- [x] 验收标准清晰可测试
- [x] 依赖关系已识别
- [x] 故事规模适当（1-3天完成）
- [x] 反映了 real.md 中的约束（R-01~R-05）
- [x] 故事地图显示清晰的用户旅程
- [x] 每个故事都有明确的用户价值

---

**文档版本**：v1.0.0
**创建日期**：2025-01-30
**基于技能**：pm-user-story (v3.1)
**维护者**：xiaoyi
