# LearnHub 产品需求规格书（可供性驱动）

<meta>
  <document-id>learnhub-pr-spec</document-id>
  <version>1.0.0</version>
  <project>LearnHub 学习平台</project>
  <type>产品需求规格书</type>
  <created>2025-01-30</created>
  <depends>real.md, cog.md</depends>
</meta>

---

## 1. 产品环境

**名称：** LearnHub

**标语：** 一个可以获取知识、提升技能、实现成长的学习环境

**版本：** 0.1.0

**环境描述：**

LearnHub 是一个虚拟商品学习平台，为个人和企业提供在线课程、会员订阅和数字资源的获取环境。平台创建了一个「知识发现 → 购买获取 → 学习消费 → 能力提升」的行动空间，让智能体（用户）能够发现、购买、学习各类数字内容。

**主要智能体：**

| 智能体类型 | 行动能力 | 主要目标 |
|------------|----------|----------|
| 个人用户 (C端) | 浏览、购买、学习、下载 | 获取知识、提升技能 |
| 企业员工 | 学习、完成任务、查看进度 | 完成企业培训任务 |
| 企业管理员 | 采购、分配、监控、管理 | 管理团队学习、控制成本 |
| 平台管理员 | 上架、定价、审核、运营 | 运营平台、创造收益 |

**核心可供性：**

1. **发现可供性** - 浏览和搜索商品
2. **购买可供性** - 下单和支付
3. **学习可供性** - 消费课程和资源
4. **管理可供性** - 企业培训管理

---

## 2. 最小可供故事（MAS）

### MAS-1：个人用户购买并学习课程

> 基础故事，使其他所有故事成为可能

**故事主题：**
将对知识的渴望转化为实际的学习行动，实现「发现 → 购买 → 学习」的完整闭环。

**核心可供性序列：**

```
1. 入口可供性：访问平台首页
   → 行动：进入学习环境
   → 感知：网站入口、清晰的导航

2. 发现可供性：浏览课程列表
   → 行动：查看可用课程
   → 感知：课程卡片、分类标签、搜索框

3. 详情可供性：查看课程详情
   → 行动：了解课程内容、价格、评价
   → 感知：课程详情页、目录、试看视频

4. 购买可供性：加入购物车、下单
   → 行动：决定购买、提交订单
   → 感知：购买按钮、价格标签、购物车图标

5. 支付可供性：完成支付
   → 行动：使用微信/支付宝付款
   → 感知：支付二维码、支付确认

6. 学习可供性：观看课程视频
   → 行动：播放视频、做笔记、完成学习
   → 感知：播放器、进度条、章节列表

7. 闭合可供性：完成课程、获得证书
   → 行动：标记完成、查看学习记录
   → 感知：完成提示、证书下载、进度100%
```

**意义闭合：**
用户从「想学习」变成「已学习」，知识转化为能力，付费转化为成长。

**内在动机：**
- 兴趣：发现新知识的好奇心
- 精通：完成课程的成就感
- 自主：自主选择学习内容和节奏

**故事依赖：**
- 需要：无（基础故事）
- 支持：MAS-2（会员订阅）、MAS-3（企业培训）

**超出范围：**
- 课程分享（不同故事）
- 学习社群（不同故事）

---

### MAS-2：个人用户订阅会员

> 与 MAS-1 复合的故事，提供更高效的学习方式

**故事主题：**
从单次购买升级为持续学习，建立长期的学习习惯。

**核心可供性序列：**

```
1. 发现可供性：了解会员权益
   → 行动：查看会员介绍页
   → 感知：会员专区入口、权益对比表

2. 对比可供性：选择会员类型
   → 行动：比较月度/季度/年度会员
   → 感知：价格对比、优惠标签、推荐标记

3. 订阅可供性：开通会员
   → 行动：选择周期、完成支付
   → 感知：订阅按钮、支付流程

4. 解锁可供性：访问会员专享内容
   → 行动：浏览和学习会员课程
   → 感知：会员标识、无购买按钮（直接学习）

5. 续费可供性：续订或升级
   → 行动：到期前续费、或升级更高级别
   → 感知：到期提醒、续费入口、升级优惠
```

**意义闭合：**
用户从「偶尔学习者」变成「持续学习者」，建立学习习惯。

**内在动机：**
- 兴趣：探索更多课程内容
- 精通：系统化学习路径
- 自主：灵活选择学习节奏

**故事依赖：**
- 需要：MAS-1（基础购买学习流程）
- 支持：MAS-3（企业会员）

**超出范围：**
- 会员等级体系（后续增强）
- 积分兑换（后续增强）

---

### MAS-3：企业培训管理

> 高级故事，面向 B 端企业用户

**故事主题：**
企业管理员为团队采购学习资源，管理员工学习进度，提升团队能力。

**核心可供性序列：**

```
1. 入驻可供性：注册企业账户
   → 行动：创建企业、验证资质
   → 感知：企业注册入口、认证流程

2. 采购可供性：批量购买课程/会员
   → 行动：选择商品、设置数量、申请报价
   → 感知：企业专区、批量购买、询价按钮

3. 分配可供性：邀请员工、分配权限
   → 行动：发送邀请链接、分配学习任务
   → 感知：员工管理后台、邀请链接生成器

4. 监控可供性：查看学习进度
   → 行动：查看团队学习数据、导出报表
   → 感知：数据看板、进度图表、导出按钮

5. 续费可供性：续订企业会员
   → 行动：续费、调整席位数量
   → 感知：到期提醒、续费管理
```

**意义闭合：**
企业从「零散培训」变成「体系化学习」，团队能力得到整体提升。

**内在动机：**
- 兴趣：了解团队成长情况
- 精通：建立企业学习文化
- 自主：自定义培训计划

**故事依赖：**
- 需要：MAS-1（基础购买学习）、MAS-2（会员体系）
- 支持：无（高级故事）

**超出范围：**
- 定制课程开发（企业定制服务）
- 线下培训（不同产品线）

---

## 3. 可供性目录

### 3.1 主要可供性（立即可感知）

| ID | 可供性 | 支持的行动 | 感知线索 | MAS |
|----|--------|------------|----------|-----|
| P-01 | 注册/登录 | 创建账户、身份验证 | 登录按钮、注册入口 | MAS-1 |
| P-02 | 课程浏览 | 查看课程列表 | 课程卡片、分类导航 | MAS-1 |
| P-03 | 课程搜索 | 关键词搜索 | 搜索框、搜索图标 | MAS-1 |
| P-04 | 课程详情 | 查看课程信息 | 详情页、目录、价格 | MAS-1 |
| P-05 | 购买下单 | 创建订单 | 购买按钮、加入购物车 | MAS-1 |
| P-06 | 支付 | 完成付款 | 支付二维码、支付按钮 | MAS-1 |
| P-07 | 视频播放 | 学习课程 | 播放器、播放按钮 | MAS-1 |
| P-08 | 资源下载 | 获取数字资源 | 下载按钮、文件图标 | MAS-1 |

### 3.2 次要可供性（通过交互揭示）

| ID | 可供性 | 支持的行动 | 揭示时机 | MAS |
|----|--------|------------|----------|-----|
| S-01 | 购物车管理 | 添加/移除商品 | 点击购物车后 | MAS-1 |
| S-02 | 订单管理 | 查看订单历史 | 进入个人中心后 | MAS-1 |
| S-03 | 学习进度 | 查看已学内容 | 进入「我的学习」后 | MAS-1 |
| S-04 | 会员管理 | 查看会员状态 | 进入会员中心后 | MAS-2 |
| S-05 | 收藏功能 | 收藏感兴趣的课程 | 浏览课程时 | MAS-1 |
| S-06 | 评价功能 | 对课程打分评论 | 完成学习后 | MAS-1 |
| S-07 | 员工管理 | 管理企业员工 | 企业管理后台 | MAS-3 |
| S-08 | 数据看板 | 查看学习统计 | 企业管理后台 | MAS-3 |

### 3.3 潜在可供性（通过探索发现）

| ID | 可供性 | 支持的行动 | 发现路径 | MAS |
|----|--------|------------|----------|-----|
| L-01 | 优惠券使用 | 应用折扣 | 结算时输入优惠码 | MAS-1 |
| L-02 | 邀请返利 | 邀请好友获得奖励 | 个人中心探索 | MAS-1 |
| L-03 | 学习笔记 | 记录学习心得 | 播放器侧边栏 | MAS-1 |
| L-04 | 快捷键 | 键盘控制播放器 | 帮助文档 | MAS-1 |
| L-05 | 批量导入 | 导入员工名单 | 企业管理后台 | MAS-3 |

---

## 4. 可供性详细规约

### 可供性：P-05 购买下单

**级别：** 主要
**启用的操作：** 将商品加入购物车并创建订单

#### 环境属性

| 属性 | 值 | 可被感知者 |
|------|---|-----------|
| 视觉线索 | 「立即购买」「加入购物车」按钮 | 人类 |
| 语义标记 | `<button data-action="buy">` | AI 智能体 |
| 交互模式 | 点击按钮 → 确认订单 → 提交 | 两者 |

#### 智能体要求

| 智能体类型 | 所需能力 |
|-----------|---------|
| 人类 | 视觉识别、点击操作 |
| AI 智能体 | DOM 访问、表单提交 |

#### 感知-行动耦合

**人类感知：**
- **看到**：课程详情页的「立即购买」按钮，橙色高亮
- **执行**：点击按钮，进入订单确认页，确认后提交
- **反馈**：「订单创建成功」提示，跳转支付页

**AI 感知：**
- **检测**：`button[data-action="buy"]` 或 `button[data-action="add-to-cart"]`
- **执行**：触发 click 事件，POST /api/orders
- **验证**：返回 201 状态码，响应包含 orderId

#### 约束条件（来自 real.md）

- 用户必须登录后才能购买
- 订单金额由服务端计算，不信任客户端
- 同一商品不能重复购买（已购买显示「已拥有」）

#### 依赖关系

- **需要**：P-01（登录）、P-04（查看详情）
- **启用**：P-06（支付）

---

### 可供性：P-07 视频播放

**级别：** 主要
**启用的操作：** 播放、暂停、跳转课程视频

#### 环境属性

| 属性 | 值 | 可被感知者 |
|------|---|-----------|
| 视觉线索 | 播放器界面、播放按钮、进度条 | 人类 |
| 语义标记 | `<video>` + 自定义控件 | AI 智能体 |
| 交互模式 | 点击播放/暂停、拖动进度条 | 两者 |

#### 感知-行动耦合

**人类感知：**
- **看到**：视频播放器占据主要区域，大播放按钮居中
- **执行**：点击播放，可暂停、调整进度、切换清晰度
- **反馈**：视频播放，进度条更新，学习进度自动记录

**AI 感知：**
- **检测**：`video` 元素，`[data-player-control]` 控件
- **执行**：video.play()、video.pause()、video.currentTime
- **验证**：playing 事件触发，timeupdate 事件持续

#### 约束条件（来自 real.md）

- 必须验证用户购买权限
- 视频流加密传输，防止非法下载
- 学习进度实时同步到服务端

#### 依赖关系

- **需要**：用户已购买该课程或拥有有效会员
- **启用**：学习进度记录、完成证书

---

## 5. 环境约束

### 5.1 物理约束

| 约束 | 对可供性的影响 |
|------|----------------|
| 移动端屏幕 | 简化界面、优先展示核心可供性、全屏播放 |
| 网络带宽 | 视频需要自适应清晰度（480p/720p/1080p） |
| 支付环境 | 需在微信/支付宝环境内唤起支付 |

### 5.2 结构约束

| 约束 | 对可供性的影响 |
|------|----------------|
| 用户身份 | 未登录只能浏览，登录后才能购买学习 |
| 购买状态 | 未购买不能访问付费内容 |
| 会员等级 | 不同等级可访问不同内容 |
| 企业隔离 | 企业 A 员工不能看企业 B 的数据 |

### 5.3 安全约束（来自 real.md）

| 约束 ID | 约束内容 | 可供性限制 |
|--------|---------|------------|
| R-01 | 密码 bcrypt 加密 | 密码输入后立即加密传输 |
| R-02 | 支付走官方 API | 仅调用微信/支付宝官方 SDK |
| R-03 | 金额服务端计算 | 客户端不可修改订单金额 |
| R-04 | 内容权限验证 | 每次播放前验证授权 |
| R-05 | 企业数据隔离 | API 层面强制校验企业归属 |

---

## 6. 感知通道

### 6.1 视觉可供性（人类用户）

| 元素 | 感知到的行动 | 设计模式 |
|------|--------------|----------|
| 橙色按钮 | 主要操作（购买、提交） | 实心、高对比、圆角 |
| 灰色按钮 | 次要操作（取消、返回） | 边框、低对比 |
| 搜索框 | 可输入查询 | 放大镜图标、placeholder |
| 课程卡片 | 可点击查看详情 | hover 效果、箭头提示 |
| 播放按钮 | 可播放视频 | 三角形图标、居中 |
| 进度条 | 当前位置、可拖动 | 颜色填充、拖动手柄 |
| 会员标识 | 会员专享内容 | 金色图标、VIP 标签 |

### 6.2 语义可供性（AI 智能体）

| 元素 | 语义标记 | 感知到的行动 |
|------|----------|--------------|
| `<button>` | role="button" | 可点击操作 |
| `<input type="search">` | role="searchbox" | 可输入搜索 |
| `<video>` | 媒体元素 | 可播放控制 |
| `aria-label` | 操作描述 | 理解操作目的 |
| `data-product-id` | 商品标识 | 识别商品 |
| `data-action` | 行为标识 | 识别可执行动作 |

### 6.3 跨模态可供性

| 可供性 | 人类通道 | AI 通道 | 统一行动 |
|--------|----------|---------|----------|
| 购买课程 | 点击购买按钮 | POST /api/orders | 创建订单 |
| 搜索课程 | 输入关键词 | GET /api/courses?q= | 检索课程 |
| 播放视频 | 点击播放 | video.play() | 开始播放 |
| 完成学习 | 看完视频 | POST /api/progress | 记录进度 |
| 下载资源 | 点击下载 | GET /api/resources/:id/download | 获取文件 |

---

## 7. 反馈机制

### 7.1 即时反馈（< 100ms）

| 操作 | 人类反馈 | AI 反馈 |
|------|----------|---------|
| 按钮点击 | 按钮变色、按下效果 | click 事件触发 |
| 输入文字 | 字符显示 | input 事件触发 |
| 收藏点击 | 心形图标变实心 | 状态变更 |
| 进度拖动 | 进度条实时更新 | timeupdate 事件 |

### 7.2 进度反馈（< 1s）

| 操作 | 人类反馈 | AI 反馈 |
|------|----------|---------|
| 提交订单 | 「提交中...」loading | pending 状态 |
| 视频加载 | 缓冲动画 | loadstart 事件 |
| 搜索查询 | 搜索动画 | 请求发送中 |
| 下载文件 | 进度条显示 | 下载进度事件 |

### 7.3 完成反馈（< 5s）

| 操作 | 人类反馈 | AI 反馈 |
|------|----------|---------|
| 订单创建 | 「订单创建成功」提示 | 200 响应 + 订单数据 |
| 支付完成 | 「支付成功」页面 | 支付回调通知 |
| 学习完成 | 「恭喜完成」弹窗 + 证书 | progress = 100% |
| 下载完成 | 文件保存提示 | download 完成事件 |

---

## 8. 可供性验收标准

### 8.1 MAS-1 验收标准（核心购买学习流程）

| ID | 可供性 | 标准 | 人类测试 | AI 测试 |
|----|--------|------|----------|---------|
| AC-01 | 注册 | 用户可创建账户 | 填写表单提交 | POST /api/auth/register 返回 201 |
| AC-02 | 登录 | 用户可登录 | 输入凭证登录 | POST /api/auth/login 返回 token |
| AC-03 | 浏览 | 可看到课程列表 | 页面展示课程卡片 | GET /api/courses 返回数组 |
| AC-04 | 搜索 | 可搜索课程 | 输入关键词有结果 | GET /api/courses?q=xxx 返回匹配项 |
| AC-05 | 详情 | 可看课程详情 | 点击进入详情页 | GET /api/courses/:id 返回数据 |
| AC-06 | 购买 | 可创建订单 | 点击购买创建订单 | POST /api/orders 返回订单号 |
| AC-07 | 支付 | 可完成支付 | 扫码支付成功 | 支付回调更新订单状态 |
| AC-08 | 授权 | 支付后获得授权 | 可访问课程内容 | GET /api/licenses 包含该课程 |
| AC-09 | 播放 | 可播放视频 | 点击播放观看 | video 元素 canplay |
| AC-10 | 进度 | 可记录学习进度 | 进度条更新 | POST /api/progress 成功 |

### 8.2 约束验证

| ID | 约束 | 验证方式 |
|----|------|----------|
| CV-01 | 密码加密 | 数据库检查：密码字段为 bcrypt 哈希 |
| CV-02 | 支付安全 | 不存储支付凭证，仅记录交易号 |
| CV-03 | 金额验证 | 篡改客户端金额后订单创建失败 |
| CV-04 | 内容保护 | 未购买用户访问付费内容返回 403 |
| CV-05 | 数据隔离 | 企业 A 管理员无法查询企业 B 数据 |

---

## 9. 非可供性（明确禁止的行动）

| 禁止的行动 | 理由 |
|------------|------|
| 未登录购买 | 需要用户身份记录购买关系和授权 |
| 未付费观看完整内容 | 保护付费内容价值 |
| 客户端修改价格 | 防止支付欺诈 |
| 下载加密视频 | 保护版权 |
| 跨企业查看数据 | 保护企业隐私（real.md R-05） |
| 分享付费内容链接 | 每个用户需独立购买授权 |
| 批量注册账号 | 防止刷单和滥用 |

---

## 10. 技术实现

### 10.1 前端可供性渲染

| 可供性 | 组件 | 技术选型 |
|--------|------|----------|
| 课程列表 | `<CourseList />`, `<CourseCard />` | React + shadcn/ui |
| 课程详情 | `<CourseDetail />` | 服务端组件 + 客户端交互 |
| 视频播放 | `<VideoPlayer />` | HTML5 Video + HLS.js |
| 购物车 | `<Cart />`, `<CartItem />` | 状态管理 + 本地存储 |
| 支付流程 | `<PaymentModal />` | 微信/支付宝 JSAPI |
| 学习进度 | `<ProgressBar />`, `<ChapterList />` | 自定义组件 |

### 10.2 后端可供性支持

| 可供性 | API 端点 | 说明 |
|--------|----------|------|
| 认证 | /api/auth/* | Neon Auth / Better Auth |
| 课程 | /api/courses/* | CRUD + 搜索 |
| 订单 | /api/orders/* | 创建 + 查询 |
| 支付 | /api/payments/* | 微信/支付宝回调 |
| 授权 | /api/licenses/* | 用户授权管理 |
| 进度 | /api/progress/* | 学习进度记录 |
| 会员 | /api/memberships/* | 会员订阅管理 |
| 企业 | /api/organizations/* | 企业管理（B端） |

### 10.3 基础设施要求

| 组件 | 选型 | 说明 |
|------|------|------|
| 前端框架 | Next.js 15 | App Router + Server Components |
| UI 组件 | shadcn/ui + Tailwind CSS | 现代化 UI |
| 数据库 | Neon PostgreSQL | 无服务器、自动扩展 |
| ORM | Drizzle ORM | 类型安全、轻量 |
| 认证 | Neon Auth | 内置用户管理 |
| 部署 | Vercel | 自动部署、边缘网络 |
| 视频存储 | 对象存储 + CDN | 视频加密分发 |
| 支付 | 微信/支付宝官方 SDK | 安全合规 |

---

## 11. 附录

### 11.1 术语表

| 术语 | 定义 |
|------|------|
| 可供性 (Affordance) | 环境为智能体提供的行动可能性 |
| MAS（最小可供故事） | 能够产生意义的最小连贯行动可能性叙事 |
| 智能体 | 能在环境中行动的实体（人类或 AI） |
| 感知通道 | 智能体发现可供性的方式 |
| 授权 (License) | 用户对商品的访问权限记录 |

### 11.2 文档依赖

- [现实约束 (real.md)](/.42cog/real/real.md) - 5 条安全/合规约束
- [认知模型 (cog.md)](/.42cog/cog/cog.md) - 7 个核心实体

### 11.3 版本历史

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| 1.0.0 | 2025-01-30 | 初始版本，定义 3 个 MAS 和核心可供性 |

---

**文档版本：** v1.0.0
**创建日期：** 2025-01-30
**基于技能：** pm-product-requirements (v4.0-lite)
**维护者：** xiaoyi
